<!-- Component to display birds and mark them as found, favorite, or want to see -->

<ul class="list bg-base-100 rounded-box shadow-lg shadow-base-300">
  @if (_birds().length > 0) {
  <div class="flex flex-col gap-3 p-4 border-b border-base-300">
    <div class="text-2xl font-semibold text-center">
      {{ mapService.observationType() === 'recent' ? 'Recently Found Birds' : 'Notable Bird Sightings' }}
    </div>

    <div class="flex flex-col gap-2 px-2">
      <div class="flex justify-between items-center text-xs opacity-70">
        <span>Radius</span>
        <span class="font-semibold">{{ mapService.radiusKm() }} km</span>
      </div>
      <input 
        type="range" 
        min="5" 
        max="50" 
        [value]="mapService.radiusKm()" 
        (input)="onRadiusDrag($event)"
        (change)="onRadiusRelease($event)"
        [disabled]="!lastLocation"
        class="range range-xs range-primary" 
        step="5" />
    </div>

    <div class="flex flex-wrap gap-2 items-center justify-center">
      <button 
        class="btn btn-xs rounded-full gap-1" 
        [class.btn-accent]="mapService.observationType() === 'notable'"
        [class.btn-ghost]="mapService.observationType() === 'recent'"
        (click)="toggleObservationType()"
        [disabled]="!lastLocation">
        <span class="text-sm">üê¶</span>
        {{ mapService.observationType() === 'recent' ? 'Notable' : 'Recent' }}
      </button>
      
      @if (accountService.currentUser()) {
      <button 
        class="btn btn-xs rounded-full gap-1" 
        [class.btn-primary]="showOnlyFavorites()"
        [class.btn-ghost]="!showOnlyFavorites()"
        (click)="toggleFilter('favorites')">
        <span class="text-sm">‚ù§Ô∏è</span>
        Favorites
      </button>
      <button 
        class="btn btn-xs rounded-full gap-1" 
        [class.btn-primary]="showOnlyWantToSee()"
        [class.btn-ghost]="!showOnlyWantToSee()"
        (click)="toggleFilter('wantToSee')">
        <span class="text-sm">üéØ</span>
        Want to See
      </button>
      <button 
        class="btn btn-xs rounded-full gap-1" 
        [class.btn-error]="hideFound()"
        [class.btn-ghost]="!hideFound()"
        (click)="toggleFilter('hideFound')">
        <span class="text-sm">‚ùå</span>
        Seen
      </button>
      }
    </div>
  </div>
  }

  @if (displayBirds().length === 0 && _birds().length === 0) {
  <!-- No birds found in this location -->
  <li class="p-4 pb-2 text-xs opacity-100 text-red-600 tracking-wide">No birds found here.</li>
  } @else if (displayBirds().length === 0) {
  <!-- Birds are found but none match current filters -->
  <li class="p-4 pb-2 text-xs opacity-60 tracking-wide text-center">No birds match the current filters. Try adjusting the filters above.</li>
  }
    
  @for (bird of displayBirds(); track $index) {
  <li class="p-4 border-b border-base-300 last:border-0 hover:bg-base-200 transition-colors">
    <div class="flex items-center gap-4 mb-2">
      <div class="flex-1 min-w-0">
        <div class="font-semibold text-lg truncate">{{ bird.comName }}</div>
        <div class="text-xs font-semibold opacity-60 italic mt-1 truncate">{{ bird.sciName }}</div>
      </div>

      <div class="flex-none flex items-center gap-2">
        <div class="text-sm opacity-70 mr-2">{{ bird.howMany }}</div>

        <!-- Bird logging buttons don't show up if user not logged in -->
        @if (accountService.currentUser()) {
        <button class="btn btn-square btn-ghost" (click)="toggleFound(bird.speciesCode)">
          <!-- Plus button -->
          @if (found(bird)) {
          <svg
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 24 24"
            stroke-width="1.5"
            stroke="currentColor"
            class="size-6"
          >
            <path stroke-linecap="round" stroke-linejoin="round" d="m4.5 12.75 6 6 9-13.5" />
          </svg>

          } @else {
          <svg
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 24 24"
            stroke-width="1.5"
            stroke="currentColor"
            class="size-6"
          >
            <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
          </svg>
          }
        </button>

        <!-- Heart button -->
        <button class="btn btn-square btn-ghost" (click)="toggleFavorite(bird.speciesCode)">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            [attr.fill]="isFavorite(bird) ? 'currentColor' : 'none'"
            [attr.color]="isFavorite(bird) ? 'red' : 'currentColor'"
            viewBox="0 0 24 24"
            stroke-width="1.5"
            stroke="currentColor"
            class="size-6"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M21 8.25c0-2.485-2.099-4.5-4.688-4.5-1.935 0-3.597 1.126-4.312 2.733-.715-1.607-2.377-2.733-4.313-2.733C5.1 3.75 3 5.765 3 8.25c0 7.22 9 12 9 12s9-4.78 9-12Z"
            />
          </svg>
        </button>
        <button class="btn btn-square btn-ghost" (click)="toggleWantToSee(bird.speciesCode)">
          <!-- Flag button -->
          <svg
            xmlns="http://www.w3.org/2000/svg"
            [attr.fill]="wantToSee(bird) ? 'currentColor' : 'none'"
            [attr.color]="wantToSee(bird) ? 'green' : 'currentColor'"
            viewBox="0 0 24 24"
            stroke-width="1.5"
            stroke="currentColor"
            class="size-6"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M3 3v1.5M3 21v-6m0 0 2.77-.693a9 9 0 0 1 6.208.682l.108.054a9 9 0 0 0 6.086.71l3.114-.732a48.524 48.524 0 0 1-.005-10.499l-3.11.732a9 9 0 0 1-6.085-.711l-.108-.054a9 9 0 0 0-6.208-.682L3 4.5M3 15V4.5"
            />
          </svg>
        </button>
        }
      </div>

      <a
        href="https://en.wikipedia.org/wiki/{{ bird.sciName }}"
        target="_blank"
        rel="noopener noreferrer"
      >
        <button class="btn btn-square btn-ghost">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 24 24"
            stroke-width="1.5"
            stroke="currentColor"
            class="size-6"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M13.5 6H5.25A2.25 2.25 0 0 0 3 8.25v10.5A2.25 2.25 0 0 0 5.25 21h10.5A2.25 2.25 0 0 0 18 18.75V10.5m-10.5 6L21 3m0 0h-5.25M21 3v5.25"
            />
          </svg>
        </button>
      </a>
    </div>
  </li>
  }
</ul>
