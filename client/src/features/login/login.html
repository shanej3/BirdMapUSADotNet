<div>
  @if (!accountService.currentUser()) {
    <button 
      (click)="toggleLogin()" 
      class="btn btn-ghost">
      {{ isOpen() ? 'Close' : 'Login' }}
    </button>

    @if (isOpen()) {
      <form [formGroup]="loginForm" (ngSubmit)="onSubmit()" class="fieldset bg-base-100 border-base-300 rounded-box w-xs border p-4 mt-2 shadow-lg">
        <legend class="fieldset-legend">{{ isRegisterMode() ? 'Register' : 'Login' }}</legend>

        <label class="label">Username</label>
        <input type="text" formControlName="userName" class="input" placeholder="Username" />

        <label class="label">Password</label>
        <input type="password" formControlName="password" class="input" placeholder="Password" />

        @if (errorMessage()) {
          <p class="text-error text-sm mt-2">{{ errorMessage() }}</p>
        }

        <button type="submit" class="btn btn-primary mt-4" [disabled]="loginForm.invalid">
          {{ isRegisterMode() ? 'Register' : 'Login' }}
        </button>
        
        <button type="button" (click)="toggleMode()" class="btn btn-ghost btn-sm mt-2 w-full">
          {{ isRegisterMode() ? 'Already have an account? Login' : 'Need an account? Register' }}
        </button>
      </form>
    }
  } @else {
    <div class="dropdown dropdown-end">
      <button tabindex="0" class="btn btn-ghost">
        {{ accountService.currentUser()?.userName }}
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" class="inline-block h-4 w-4 stroke-current"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m19 9-7 7-7-7"></path></svg>
      </button>
      <ul tabindex="0" class="dropdown-content menu bg-base-100 rounded-box z-[1] w-52 p-2 shadow mt-2">
        <li><button (click)="onLogout()" class="text-error">Logout</button></li>
      </ul>
    </div>
  }
</div>